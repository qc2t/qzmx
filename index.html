<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›²è½´æ•°æ®æŸ¥è¯¢ç³»ç»Ÿï¼ˆè¡¨æ ¼ç‰ˆï¼‰</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px 0; }
        .container-fluid { max-width: 1400px; } /* å®½å±æ˜¾ç¤º */
        
        /* æœç´¢æ¡†æ ·å¼ä¼˜åŒ– */
        .search-area {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        /* è¡¨æ ¼æ ·å¼ä»¿ Excel */
        .table-container {
            background: white;
            border-radius: 8px;
            overflow-x: auto; /* å…³é”®ï¼šæ‰‹æœºç«¯å…è®¸æ¨ªå‘æ»šåŠ¨ */
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .table {
            margin-bottom: 0;
            white-space: nowrap; /* å…³é”®ï¼šé˜²æ­¢æ–‡å­—æ¢è¡Œï¼Œä¿æŒè¡¨æ ¼æ•´é½ */
            font-size: 0.95rem;
        }
        
        .table thead th {
            background-color: #e9ecef;
            color: #495057;
            position: sticky; /* è¡¨å¤´å›ºå®š */
            top: 0;
            z-index: 1;
        }
        
        /* é€‰ä¸­è¡Œé«˜äº® */
        .highlight-row { background-color: #fff3cd !important; }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="text-center mb-3">
        <h3>ğŸ“Š æ›²è½´ä¿¡æ¯è¡¨æŸ¥è¯¢</h3>
    </div>

    <div class="search-area">
        <div class="input-group">
            <input type="text" id="searchInput" class="form-control form-control-lg" placeholder="è¾“å…¥è½´å·æŸ¥è¯¢ï¼ˆå¦‚ï¼š2006T6 æˆ– 367ï¼‰">
            <button class="btn btn-primary btn-lg px-4" type="button" onclick="performSearch()">æŸ¥è¯¢</button>
            <button class="btn btn-outline-secondary btn-lg" type="button" onclick="resetTable()">é‡ç½®(æ˜¾ç¤ºå…¨éƒ¨)</button>
        </div>
        <div class="form-text mt-2 text-muted">æç¤ºï¼šæ”¯æŒæ¨¡ç³Šæœç´¢ï¼Œç»“æœå°†ä¿ç•™æºæ–‡ä»¶è¡¨æ ¼æ ¼å¼ã€‚</div>
    </div>

    <div id="loading" class="text-center text-muted my-4">æ­£åœ¨åŠ è½½æ•°æ®...</div>
    <div class="table-container d-none" id="tableWrapper">
        <table class="table table-bordered table-striped table-hover" id="dataTable">
            <thead id="tableHead">
                </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>
    <div id="noResult" class="alert alert-warning text-center d-none mt-3">æœªæ‰¾åˆ°ç›¸å…³è®°å½•</div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
    let allData = [];
    let tableHeaders = [];

    // 1. åˆå§‹åŒ–ï¼šåŠ è½½ CSV
    window.onload = function() {
        Papa.parse("data.csv", {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                allData = results.data;
                tableHeaders = results.meta.fields; // è·å–æ‰€æœ‰åˆ—å
                
                if(allData.length > 0) {
                    initTableHeaders();
                    renderTable(allData); // é»˜è®¤æ˜¾ç¤ºå‰50æ¡æˆ–å…¨éƒ¨ï¼Œé¿å…é¡µé¢å¡é¡¿
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('tableWrapper').classList.remove('d-none');
                }
            },
            error: function() {
                document.getElementById('loading').innerHTML = '<span class="text-danger">æ— æ³•è¯»å– data.csvï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸Šä¼ ã€‚</span>';
            }
        });
    };

    // 2. åˆå§‹åŒ–è¡¨å¤´ (åŠ¨æ€è¯»å– CSV åˆ—å)
    function initTableHeaders() {
        let theadHtml = '<tr>';
        // æ·»åŠ åºå·åˆ—
        theadHtml += '<th style="width:50px">#</th>';
        
        tableHeaders.forEach(header => {
            // è¿‡æ»¤æ‰ç©ºçš„åˆ—åï¼ˆå¦‚æœæœ‰ï¼‰
            if(header && header.trim() !== "") {
                theadHtml += `<th>${header}</th>`;
            }
        });
        theadHtml += '</tr>';
        document.getElementById('tableHead').innerHTML = theadHtml;
    }

    // 3. æ¸²æŸ“è¡¨æ ¼å†…å®¹
    function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        const maxDisplay = 100; // é™åˆ¶é»˜è®¤æ˜¾ç¤ºæ¡æ•°ï¼Œé˜²æ­¢ç½‘é¡µå¡æ­»
        let html = '';

        if (data.length === 0) {
            document.getElementById('tableWrapper').classList.add('d-none');
            document.getElementById('noResult').classList.remove('d-none');
            return;
        } else {
            document.getElementById('tableWrapper').classList.remove('d-none');
            document.getElementById('noResult').classList.add('d-none');
        }

        // ä»…æ¸²æŸ“ç¬¦åˆæ¡ä»¶çš„æ•°æ®
        const displayData = data.slice(0, maxDisplay); // å¦‚æœæ•°æ®é‡å·¨å¤§ï¼Œä»…å±•ç¤ºå‰100æ¡ç”¨äºé¢„è§ˆï¼Œæˆ–è€…å±•ç¤ºæœç´¢ç»“æœçš„æ‰€æœ‰å†…å®¹
        
        displayData.forEach((row, index) => {
            html += '<tr>';
            html += `<td>${index + 1}</td>`; // åºå·
            
            tableHeaders.forEach(header => {
                if(header && header.trim() !== "") {
                    let cellValue = row[header] || ""; 
                    html += `<td>${cellValue}</td>`;
                }
            });
            html += '</tr>';
        });

        tbody.innerHTML = html;
        
        if (data.length > maxDisplay) {
            // å¦‚æœç»“æœå¤ªå¤šï¼Œæç¤ºä¸€ä¸‹
            tbody.innerHTML += `<tr><td colspan="${tableHeaders.length + 1}" class="text-center text-muted">... æ•°æ®è¾ƒå¤šï¼Œä»…æ˜¾ç¤ºå‰ ${maxDisplay} æ¡ï¼Œè¯·ä¼˜åŒ–æœç´¢å…³é”®è¯ ...</td></tr>`;
        }
    }

    // 4. æ‰§è¡Œæœç´¢
    function performSearch() {
        const query = document.getElementById('searchInput').value.trim().toUpperCase();
        
        if (!query) {
            // å¦‚æœä¸ºç©ºï¼Œæ˜¾ç¤ºå…¨éƒ¨ï¼ˆå— maxDisplay é™åˆ¶ï¼‰
            renderTable(allData);
            return;
        }

        const filtered = allData.filter(row => {
            // åœ¨ "è½´å·" åˆ—ä¸­æœç´¢ (æ‚¨å¯ä»¥ä¿®æ”¹è¿™é‡Œæ”¹ä¸ºå…¨è¡¨æœç´¢)
            // ç›®å‰è®¾å®šï¼šåªæœè½´å·ã€‚å¦‚æœæƒ³æœæ‰€æœ‰åˆ—ï¼Œè¯·çœ‹ä¸‹æ–¹æ³¨é‡Š
            if (row['è½´å·']) {
                return row['è½´å·'].toString().toUpperCase().includes(query);
            }
            return false;
        });

        renderTable(filtered);
    }

    // 5. é‡ç½®
    function resetTable() {
        document.getElementById('searchInput').value = '';
        renderTable(allData);
    }

    // å›è½¦æœç´¢æ”¯æŒ
    document.getElementById("searchInput").addEventListener("keypress", function(event) {
        if (event.key === "Enter") { performSearch(); }
    });
</script>

</body>
</html>